# AI Provider Switcher - Technical Architecture

> à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¹à¸¥à¸°à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸£à¸°à¸šà¸šà¸ªà¸¥à¸±à¸š AI Provider

---

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Interface                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Settings   â”‚  â”‚ Smart Taggingâ”‚  â”‚ PMQA Chatbot      â”‚   â”‚
â”‚  â”‚ AI Toggle  â”‚  â”‚              â”‚  â”‚                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI Service Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ai-service.ts (Central)                 â”‚   â”‚
â”‚  â”‚  - chat()                                            â”‚   â”‚
â”‚  â”‚  - generateText()                                    â”‚   â”‚
â”‚  â”‚  - analyzeEvidence()                                 â”‚   â”‚
â”‚  â”‚  - Auto Provider Selection                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚         â–¼                    â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   Gemini    â”‚      â”‚   Ollama    â”‚                      â”‚
â”‚  â”‚  Provider   â”‚      â”‚  Provider   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚
          â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Google  â”‚          â”‚    Ollama    â”‚
    â”‚  Gemini  â”‚          â”‚    Server    â”‚
    â”‚   API    â”‚          â”‚  (Local/VPS) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Provider Selection Logic

```typescript
// Pseudocode
async function chat(message: string) {
  // 1. Get user preference
  const userPref = getUserPreference(); // 'gemini' | 'ollama'
  
  // 2. Check if preferred provider is available
  if (userPref === 'ollama') {
    const isOllamaHealthy = await checkOllamaHealth();
    
    if (isOllamaHealthy) {
      // Use Local AI
      return await ollamaProvider.chat(message);
    } else {
      // Fallback to Cloud AI
      showNotification('Local AI unavailable, using Cloud AI');
      return await geminiProvider.chat(message);
    }
  } else {
    // Use Cloud AI
    return await geminiProvider.chat(message);
  }
}
```

---

## ğŸ“Š Data Flow

### Scenario 1: User à¹€à¸¥à¸·à¸­à¸ Local AI (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Sensitive)

```
User Input (SAR à¸¥à¸±à¸š)
    â†“
Settings: Local AI âœ…
    â†“
ai-service.ts â†’ Check Preference â†’ "ollama"
    â†“
Check Ollama Health â†’ âœ… Online
    â†“
Send to Ollama (localhost:11434)
    â†“
Ollama Model (qwen2.5:14b) process
    â†“
Response â†’ à¹„à¸¡à¹ˆà¸­à¸­à¸à¸ˆà¸²à¸ Server
    â†“
Display to User ğŸ 
```

### Scenario 2: User à¹€à¸¥à¸·à¸­à¸ Cloud AI (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹ˆà¸§à¹„à¸›)

```
User Input (à¸„à¸³à¸–à¸²à¸¡ PMQA)
    â†“
Settings: Cloud AI â˜ï¸
    â†“
ai-service.ts â†’ Check Preference â†’ "gemini"
    â†“
Send to Google Gemini API
    â†“
Gemini Pro 1.5 process
    â†“
Response â†’ à¹à¸¡à¹ˆà¸™à¸¢à¸³à¸ªà¸¹à¸‡
    â†“
Display to User â˜ï¸
```

---

## ğŸ¨ UI/UX Design

### Settings Page - AI Provider Section

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  AI Provider Settings                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                        â•‘
â•‘  à¹€à¸¥à¸·à¸­à¸ AI Provider:                                    â•‘
â•‘                                                        â•‘
â•‘  â—‹ Cloud AI (Google Gemini)                           â•‘
â•‘    âœ“ à¸„à¸§à¸²à¸¡à¹à¸¡à¹ˆà¸™à¸¢à¸³à¸ªà¸¹à¸‡                                    â•‘
â•‘    âœ“ à¹€à¸£à¹‡à¸§                                              â•‘
â•‘    âš ï¸ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸‡à¹„à¸› Google                              â•‘
â•‘                                                        â•‘
â•‘  â— Local AI (Ollama)                      [ğŸŸ¢ Online] â•‘
â•‘    âœ“ à¸„à¸§à¸²à¸¡à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§ 100%                             â•‘
â•‘    âœ“ à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢                                  â•‘
â•‘    âš ï¸ à¸•à¹‰à¸­à¸‡à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Ollama server                       â•‘
â•‘                                                        â•‘
â•‘  [â„¹ï¸ à¸§à¸´à¸˜à¸µà¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Ollama]                              â•‘
â•‘                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ âš™ï¸ Advanced Settings                             â”‚ â•‘
â•‘  â”‚                                                  â”‚ â•‘
â•‘  â”‚ Ollama Server URL: http://localhost:11434       â”‚ â•‘
â•‘  â”‚ Model: qwen2.5:14b                              â”‚ â•‘
â•‘  â”‚                                                  â”‚ â•‘
â•‘  â”‚ [Test Connection]                                â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                        â•‘
â•‘  [ğŸ’¾ Save Settings]                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Smart Tagging - Provider Indicator

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Smart Evidence Tagging                â•‘
â•‘                          [ğŸ  Local AI] â•‘  â† Badge
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                        â•‘
â•‘  File: à¸£à¸²à¸¢à¸‡à¸²à¸™_SAR_à¸¥à¸±à¸š.pdf             â•‘
â•‘                                        â•‘
â•‘  Suggested Tags:                       â•‘
â•‘  â€¢ à¸«à¸¡à¸§à¸”à¸—à¸µà¹ˆ 1: à¸ à¸²à¸§à¸°à¸œà¸¹à¹‰à¸™à¸³               â•‘
â•‘  â€¢ à¹€à¸à¸“à¸‘à¹Œ 1.1: à¸§à¸´à¸ªà¸±à¸¢à¸—à¸±à¸¨à¸™à¹Œ              â•‘
â•‘                                        â•‘
â•‘  [âœ“ Apply Tags]                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ” Security & Privacy

### Data Privacy Matrix

| Feature | Cloud AI | Local AI | Data Leaves Server? |
|---------|----------|----------|-------------------|
| Chat with PMQA | âš ï¸ Yes | âœ… No | Cloud: Yes, Local: No |
| Smart Tagging | âš ï¸ Yes | âœ… No | Cloud: Yes, Local: No |
| Writing Assistant | âš ï¸ Yes | âœ… No | Cloud: Yes, Local: No |
| SWOT Analysis | âš ï¸ Yes | âœ… No | Cloud: Yes, Local: No |

### Recommendation for Sensitive Data

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸›à¸£à¸°à¹€à¸ à¸—             à¹à¸™à¸°à¸™à¸³         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SAR à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸„à¸§à¸²à¸¡à¸¥à¸±à¸š       ğŸ  Local AI  â”‚
â”‚  à¸«à¸¥à¸±à¸à¸à¸²à¸™à¸Šà¸±à¹‰à¸™à¸¥à¸±à¸š           ğŸ  Local AI  â”‚
â”‚  à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸šà¸¸à¸„à¸„à¸¥         ğŸ  Local AI  â”‚
â”‚  à¸„à¸³à¸–à¸²à¸¡ PMQA à¸—à¸±à¹ˆà¸§à¹„à¸›       â˜ï¸ Cloud AI  â”‚
â”‚  à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸—à¸µà¹ˆà¹„à¸¡à¹ˆ sensitive â˜ï¸ Cloud AI  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Performance Comparison

| Metric | Cloud AI (Gemini) | Local AI (Ollama) |
|--------|------------------|-------------------|
| **Response Time** | 1-3 à¸§à¸´à¸™à¸²à¸—à¸µ | 3-10 à¸§à¸´à¸™à¸²à¸—à¸µ* |
| **Accuracy (Thai)** | 95% | 85% |
| **Cost/Request** | ~à¸¿0.01 | à¸Ÿà¸£à¸µ |
| **Requires Internet** | âœ… Yes | âŒ No |
| **Data Privacy** | âš ï¸ Moderate | âœ… High |

*à¸‚à¸¶à¹‰à¸™à¸à¸±à¸š hardware à¸‚à¸­à¸‡ Ollama server

---

## ğŸš€ Quick Start Guide (à¸ªà¸³à¸«à¸£à¸±à¸š User)

### Step 1: à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Ollama (IT Admin)

```bash
# Windows
winget install Ollama.Ollama

# à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹‚à¸¡à¹€à¸”à¸¥
ollama pull qwen2.5:14b

# à¹€à¸£à¸´à¹ˆà¸¡ server
ollama serve
```

### Step 2: Config à¹ƒà¸™ Web App (Admin)

1. à¹€à¸‚à¹‰à¸² Admin â†’ AI Settings
2. Set Ollama URL: `http://localhost:11434`
3. Enable Local AI
4. Test Connection

### Step 3: User à¹€à¸¥à¸·à¸­à¸ Provider

1. à¹€à¸‚à¹‰à¸² Settings â†’ AI Provider
2. à¹€à¸¥à¸·à¸­à¸ "Local AI"
3. Save Settings
4. à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™!

---

## ğŸ’¡ Best Practices

### When to Use Local AI:
âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ SAR à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸„à¸§à¸²à¸¡à¸¥à¸±à¸š
âœ… à¸«à¸¥à¸±à¸à¸à¸²à¸™à¸Šà¸±à¹‰à¸™à¸¥à¸±à¸š
âœ… à¸à¸²à¸£à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡à¸—à¸µà¹ˆ sensitive
âœ… à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸šà¹ˆà¸­à¸¢à¸¡à¸²à¸ (à¸›à¸£à¸°à¸«à¸¢à¸±à¸”à¸„à¹ˆà¸² API)

### When to Use Cloud AI:
âœ… à¸„à¸³à¸–à¸²à¸¡ PMQA à¸—à¸±à¹ˆà¸§à¹„à¸›
âœ… à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸„à¸§à¸²à¸¡à¹à¸¡à¹ˆà¸™à¸¢à¸³à¸ªà¸¹à¸‡à¸ªà¸¸à¸”
âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹„à¸¡à¹ˆ sensitive
âœ… à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™ (SWOT)

---

## ğŸ¯ Success Metrics

à¸à¸²à¸£à¸§à¸±à¸”à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸‚à¸­à¸‡ feature à¸™à¸µà¹‰:

- **Adoption Rate**: % à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸µà¹ˆà¸¥à¸­à¸‡ Local AI
- **Retention**: % à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ Local AI à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡
- **Cost Saving**: à¸¥à¸”à¸„à¹ˆà¸² Gemini API à¸¥à¸‡à¸à¸µà¹ˆ %
- **Privacy Score**: % à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ sensitive à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ Local AI
- **Fallback Rate**: % à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡ fallback à¸ˆà¸²à¸ Local â†’ Cloud

---

## ğŸ”® Future Enhancements

### v2.0
- Fine-tune Ollama model with PMQA-specific data
- Support multiple Local AI models
- Auto-switch based on data sensitivity detection

### v3.0
- Distributed Ollama cluster
- Model quantization for faster inference
- GPU acceleration optimization
